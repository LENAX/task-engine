# 量化数据管理系统异步任务调度引擎 - 个人开发计划

## 一、计划概述

**核心约束**：个人开发者 | 每周投入5-7小时 | Go语言基础薄弱

**核心目标**：先掌握项目所需Go基础，再分模块迭代开发，最终实现“声明式定义、DAG编排、实例管控、多数据库适配、插件扩展”的核心功能，优先保障可用性，再优化扩展性。

**总周期预估**：24-30周（按每周6小时计算，含学习+开发+测试；可根据学习进度灵活调整）

**迭代原则**：小步快跑，每个阶段完成后必须产出可运行的代码/功能，避免“只学不练”或“盲目开发”。

## 二、阶段划分与详细计划

### 第一阶段：Go语言基础攻坚 + 项目需求拆解（第1-3周）

**阶段目标**：掌握项目必备的Go基础语法，完成需求细化和模块拆解，输出清晰的开发清单。

**每周投入**：6小时/周（以学习为主，少量需求梳理）

#### 第1周：Go语言核心基础（变量、函数、结构体、接口）

- 学习内容：
        

    - Go基本语法（变量定义、循环、条件判断、函数声明与调用）

    - 结构体（struct）与方法（项目中核心数据结构的基础）

    - 接口（interface）基础（插件机制、存储适配的核心）

- 学习资源：Go官方文档（Tour of Go）、B站《Go语言基础入门》（10集以内精简教程）

- 产出物：3个小demo（结构体定义与方法调用、接口实现与多态、简单函数封装）

#### 第2周：Go并发基础 + 项目核心需求拆解

- 学习内容：
        

    - Go并发基础（goroutine、channel、sync包基础，对应项目中的Executor并发执行）

    - Go文件操作与配置解析（对应项目的YAML/TOML配置加载）

- 需求梳理：
        

    - 细化核心模块（Workflow、Task、Engine等）的职责与交互关系

    - 明确“必须实现”和“可选实现”的功能（如SAGA事务可后期迭代，先实现基础调度）

- 产出物：并发小demo（2个goroutine通过channel通信）、项目需求细化文档（含模块职责清单）

#### 第3周：Go数据库操作 + 项目模块拆解

- 学习内容：
       

    - Go数据库驱动基础（database/sql包），重点学习SQLite操作（轻量易上手，适合初期开发）

    - JSON/YAML配置解析（使用viper包，项目配置加载的核心工具）

- 模块拆解：
        

    - 拆分每个模块的核心数据结构（如Workflow的字段、Task的状态枚举）

    - 绘制模块交互流程图（简化版，明确Engine与Executor、存储层的调用关系）

- 产出物：SQLite增删改查demo、项目模块拆解文档（含数据结构定义初稿、模块交互图）

### 第二阶段：核心模块开发（一）- 基础数据结构与存储层（第4-8周）

**阶段目标**：实现Workflow、Task、WorkflowInstance的核心数据结构，完成基础存储层（先支持SQLite），实现数据的持久化与查询。

**每周投入**：6小时/周（开发为主，边开发边补全所需Go知识）

#### 第4周：核心数据结构定义与初始化

- 开发任务：
        

    - 定义核心结构体：Workflow（模板）、WorkflowInstance（实例）、Task、JobFunctionMeta（函数元数据）

    - 定义状态枚举（如WorkflowInstance状态：就绪/运行中/暂停/失败等）

    - 编写初始化函数（如NewWorkflow、NewTask），实现基础参数校验

- 学习补充：Go枚举实现（iota）、结构体标签（json/db映射）

- 产出物：核心数据结构代码文件（model/目录下）、单元测试（验证初始化与参数校验）

#### 第5周：存储层接口设计与SQLite实现（Workflow模板）

- 开发任务：
        

    - 设计存储层接口（WorkflowRepository）：定义SaveWorkflow、GetWorkflow、ListWorkflows方法

    - 实现SQLite版本的WorkflowRepository（创建workflow_definition表，编写SQL语句）

    - 编写测试代码，验证Workflow模板的增删改查

- 学习补充：Go接口设计规范、SQLite事务操作

- 产出物：存储层接口代码（repository/目录下）、SQLite实现代码、测试用例（可成功持久化Workflow模板）

#### 第6周：存储层扩展（WorkflowInstance + Task）

- 开发任务：
        

    - 扩展存储层接口：新增WorkflowInstanceRepository、TaskRepository

    - 实现SQLite版本的实例与Task存储（创建workflow_instance、task_instance表）

    - 实现“按模板ID查询实例列表”功能（关联workflow_id）

- 学习补充：SQL关联查询、Go错误处理最佳实践

- 产出物：完整的SQLite存储层代码、表结构设计文档、测试用例（验证实例与Task的持久化）

#### 第7周：配置加载模块开发（支持YAML）

- 开发任务：
        

    - 使用viper包实现YAML配置加载（支持引擎配置、数据库配置）

    - 编写配置初始化函数（LoadConfig），支持从指定路径加载配置文件

    - 实现配置校验（如数据库路径、并发池大小合法性）

- 学习补充：viper包使用、Go配置管理最佳实践

- 产出物：配置模块代码（config/目录下）、示例配置文件（config.yaml）、测试用例（成功加载配置）

#### 第8周：存储层集成测试与优化

- 开发任务：
        

    - 编写集成测试：模拟“创建Workflow模板→创建实例→关联Task”的完整流程，验证数据一致性

    - 优化存储层代码：修复测试中发现的bug（如字段映射错误、事务未提交等）

    - 添加日志打印（使用log包），便于调试存储层操作

- 产出物：集成测试代码、优化后的存储层代码、带日志的可运行存储模块

### 第三阶段：核心模块开发（二）- Builder模式与Workflow管控（第9-13周）

**阶段目标**：实现WorkflowBuilder与TaskBuilder，完成WorkflowController的基础管控功能（创建实例、启停、状态查询），让用户可通过代码/配置定义并管控任务流。

**每周投入**：6小时/周

#### 第9周：TaskBuilder实现

- 开发任务：
        

    - 实现TaskBuilder：提供WithID、WithName、WithJobFunction、WithTimeout等链式方法

    - 在Builder中实现参数校验（如TaskID不能为空、超时时间需大于0）

    - 编写测试代码，验证通过Builder可成功构建Task

- 学习补充：Builder模式设计规范、Go链式调用实现

- 产出物：TaskBuilder代码（builder/目录下）、测试用例

#### 第10周：WorkflowBuilder实现（含DAG依赖基础）

- 开发任务：
        

    - 实现WorkflowBuilder：提供WithID、WithName、WithTask、WithDAGDependency等方法

    - 实现简单的DAG依赖解析（记录Task间的依赖关系，如TaskB依赖TaskA）

    - 支持从YAML配置文件加载Workflow模板（通过Builder的WithConfigFile方法）

- 产出物：WorkflowBuilder代码、YAML配置加载功能、测试用例（通过Builder/配置文件创建带依赖的Workflow）

#### 第11周：WorkflowController基础功能实现

- 开发任务：
        

    - 实现WorkflowController：作为用户管控句柄，提供CreateInstance、GetInstanceStatus方法

    - 关联存储层：通过Controller调用Repository完成实例的创建与查询

    - 编写测试代码，验证“创建Workflow模板→通过Controller创建实例→查询实例状态”流程

- 学习补充：Go面向对象封装（Controller作为句柄的设计思路）

- 产出物：WorkflowController代码（controller/目录下）、测试用例

#### 第12周：WorkflowController扩展（启停、暂停、恢复）

- 开发任务：
        

    - 扩展Controller功能：实现StartInstance、PauseInstance、ResumeInstance、TerminateInstance方法

    - 实现状态变更逻辑（如PauseInstance需将实例状态改为“暂停”并持久化）

    - 添加状态变更校验（如已终止的实例不能再启动）

- 产出物：完整的Controller代码、测试用例（验证实例全生命周期管控）

#### 第13周：Builder与Controller集成测试

- 开发任务：
        

    - 编写集成测试：模拟用户使用流程（Builder创建模板→Controller创建实例→启停管控→查询状态）

    - 修复测试中的bug（如状态变更不一致、参数校验遗漏等）

    - 补充代码注释，优化代码可读性

- 产出物：集成测试代码、可运行的“模板定义+实例管控”核心流程

### 第四阶段：核心模块开发（三）- Engine调度核心与Executor并发执行（第14-18周）

**阶段目标**：实现Engine核心调度逻辑、Executor并发执行池，完成“调度-执行”链路打通，支持Task的基础执行与DAG依赖调度。

**每周投入**：6小时/周（重点攻克并发调度逻辑，边开发边补全Go并发进阶知识）

#### 第14周：Engine初始化与核心结构定义

- 开发任务：

- 定义Engine核心结构体，关联存储层Repository、Executor、WorkflowInstanceManager

- 实现Engine初始化函数（NewEngine），支持加载配置（并发池大小、超时阈值等）

- 实现Engine与WorkflowController的关联逻辑（Submit方法返回Controller句柄）

- 学习补充：Go依赖注入基础（模块间解耦）、结构体组合复用

- 产出物：Engine核心代码（engine/目录下）、初始化测试用例

#### 第15周：DAG依赖解析与执行顺序规划

- 开发任务：

- 实现DAG解析器：基于Workflow的依赖关系，生成Task拓扑排序结果（执行顺序）

- 处理简单依赖场景（如线性依赖：TaskA→TaskB→TaskC），输出执行顺序列表

- 编写测试用例，验证不同依赖结构的解析正确性

- 学习补充：拓扑排序算法、Go切片/映射操作优化

- 产出物：DAG解析器代码（engine/dag/目录下）、依赖解析测试用例

#### 第16周：Executor并发执行池实现

- 开发任务：

- 实现Executor结构体，基于goroutine+channel构建并发池（可配置最大并发数）

- 实现Task执行接口（ExecuteTask），支持接收Task并异步执行

- 添加执行超时控制（使用context包），避免任务阻塞

- 学习补充：Go context包使用、并发池设计模式、超时控制最佳实践

- 产出物：Executor代码（executor/目录下）、并发执行测试用例（验证多Task并行执行）

#### 第17周：Engine调度逻辑实现（基础调度）

- 开发任务：

- 打通Engine与Executor：Engine解析DAG后，将Task按顺序分发至Executor执行池

- 实现Task执行状态同步：Executor将执行结果回调给Engine，Engine更新TaskInstance状态

- 支持简单的动态子任务感知（接收Task生成的子Task，暂存至实例中）

- 产出物：Engine调度核心代码、“调度-执行-状态同步”链路代码、测试用例

#### 第18周：Engine与Executor集成测试

- 开发任务：

- 编写集成测试：模拟完整流程（Builder创建带依赖的Workflow→Engine调度→Executor执行→状态同步）

- 修复调度逻辑bug（如依赖顺序错误、并发安全问题、状态同步延迟）

- 优化并发控制：添加sync.Mutex保障共享资源（如实例状态）的并发安全

- 产出物：集成测试代码、可运行的“调度-执行”核心链路、优化后的Engine与Executor代码

### 第五阶段：扩展功能开发（一）- 插件机制与多数据库适配（第19-23周）

**阶段目标**：实现插件扩展机制（支持Workflow/Task级绑定）、多数据库适配（新增MySQL/PostgreSQL支持），提升项目扩展性与部署灵活性。

**每周投入**：6小时/周（聚焦接口设计与适配开发，复用之前的存储层接口设计思路）

#### 第19周：插件接口设计与基础框架实现

- 开发任务：

- 定义Plugin标准接口（Name() string、Trigger(ctx context.Context, data interface{}) error）

- 实现PluginManager：提供插件注册（Register）、加载（Load）、触发（Trigger）方法

- 实现插件与Engine的关联：Engine接收状态变更事件，调用PluginManager触发对应插件

- 学习补充：Go接口设计规范、事件驱动编程基础

- 产出物：插件框架代码（plugin/目录下）、Plugin与PluginManager接口代码、测试用例

#### 第20周：内置插件实现与绑定逻辑

- 开发任务：

- 实现2个内置插件：邮件通知插件（使用net/smtp包）、日志记录插件

- 实现插件绑定逻辑：支持通过Builder为Workflow（如实例失败）、Task（如执行失败）绑定插件

- 编写测试用例：验证插件注册、绑定与触发流程（如Task失败触发邮件通知）

- 学习补充：Go邮件发送基础、配置文件中插件参数解析

- 产出物：内置插件代码、插件绑定代码、端到端测试用例

#### 第21周：多数据库适配（MySQL实现）

- 开发任务：

- 基于现有存储层接口，实现MySQL版本的Repository（Workflow/Instance/Task）

- 创建MySQL表结构（与SQLite表结构兼容，适配MySQL语法）

- 实现数据库适配工厂：根据配置文件自动选择SQLite/MySQL存储实现

- 学习补充：Go MySQL驱动使用、跨数据库SQL语法兼容技巧

- 产出物：MySQL存储实现代码、表结构脚本、数据库适配工厂代码、测试用例

#### 第22周：多数据库适配（PostgreSQL）与配置扩展

- 开发任务：

- 实现PostgreSQL版本的Repository，适配PostgreSQL的JSON字段特性（存储DAG依赖）

- 扩展配置模块：支持在YAML配置中指定数据库类型及连接参数

- 编写测试用例：验证三种数据库的切换与数据一致性

- 产出物：PostgreSQL存储实现代码、配置扩展代码、多数据库切换测试用例

#### 第23周：插件与多数据库集成测试

- 开发任务：

- 编写集成测试：覆盖“多数据库存储+插件触发”全流程（如MySQL存储实例→Task失败触发邮件插件）

- 优化插件触发性能：避免插件阻塞Engine主线程（使用goroutine异步触发）

- 修复适配过程中的兼容性bug（如字段类型差异、SQL语法差异）

- 产出物：集成测试代码、优化后的插件与存储层代码

### 第六阶段：扩展功能开发（二）- 定时调度、断点恢复与HTTP API（第24-26周）

**阶段目标**：实现定时调度（Cron）、断点恢复核心功能，开发HTTP API接口，支持远程管控，完善项目核心能力。

**每周投入**：6小时/周（优先实现核心扩展功能，API聚焦常用接口）

#### 第24周：定时调度功能实现（Cron）

- 开发任务：

- 集成第三方Cron库（如robfig/cron），实现定时调度器

- 关联Workflow模板：支持通过Builder配置Crontab表达式，Engine自动创建定时实例

- 实现定时开关与状态同步：支持启用/禁用定时，记录定时触发历史

- 学习补充：Cron表达式解析、Go第三方库集成方法

- 产出物：定时调度模块代码（engine/cron/目录下）、测试用例（验证定时触发实例）

#### 第25周：断点恢复功能实现

- 开发任务：

- 实现断点记录逻辑：Engine定期保存实例的执行进度（当前执行Task、上下文数据）至存储层

- 实现断点恢复逻辑：系统重启后，Engine加载未完成实例的断点数据，从断点续跑

- 添加断点清理策略：实例完成/终止后自动清理断点数据

- 学习补充：Go上下文（context）数据传递、持久化数据序列化（如JSON）

- 产出物：断点恢复模块代码、测试用例（验证重启后断点续跑）

#### 第26周：HTTP API基础接口实现

- 开发任务：

- 使用Go标准库net/http实现基础API接口：创建Workflow模板、创建实例、查询状态、启停实例

- 实现API参数校验与错误处理，返回标准化JSON响应

- 编写测试用例：通过curl/postman调用API验证功能

- 学习补充：Go HTTP服务开发、JSON序列化/反序列化、RESTful API设计规范

- 产出物：HTTP API代码（api/目录下）、API文档（接口说明+示例）、测试用例

### 第七阶段：可选功能开发（SAGA事务）+ 全面测试与优化（第27-30周）

**阶段目标**：按需实现SAGA事务（可选），完成全链路测试、性能优化与文档完善，确保项目稳定可用。

**每周投入**：6小时/周（测试与优化为主，SAGA事务根据时间灵活调整）

#### 第27周：SAGA事务实现（可选）

- 开发任务：

- 实现SAGA事务协调器：支持定义补偿函数，按反向顺序执行补偿

- 关联Task与Workflow：通过Builder为Task配置补偿函数，启用SAGA事务

- 编写测试用例：验证SAGA事务的正常执行与失败补偿逻辑

- 学习补充：SAGA事务模式、分布式事务基础

- 产出物：SAGA事务模块代码（可选）、测试用例

#### 第28周：全链路测试与bug修复

- 开发任务：

- 编写全链路测试用例：覆盖“模板定义→定时调度→并发执行→断点恢复→插件触发→API管控”完整流程

- 进行压力测试：模拟10个并发实例执行，验证Executor并发控制与存储层性能

- 修复测试中发现的功能bug与性能问题（如内存泄漏、执行阻塞）

- 学习补充：Go压力测试方法（testing包）、性能分析工具（pprof）基础

- 产出物：全链路测试代码、压力测试报告、bug修复记录

#### 第29周：性能优化与代码重构

- 开发任务：

- 性能优化：优化DAG解析效率（缓存拓扑排序结果）、减少数据库交互（添加内存缓存热点数据）

- 代码重构：简化冗余代码，优化模块间依赖，提升代码可读性与可维护性

- 补充异常处理：完善边界场景的错误处理（如数据库连接失败、插件触发失败）

- 产出物：优化后的代码、重构文档、异常处理完善记录

#### 第30周：文档完善与项目交付

- 开发任务：

- 完善项目文档：编写用户手册（环境搭建、快速上手、API使用）、开发手册（模块设计、代码结构）

- 整理产出物：汇总所有代码文件、测试用例、配置示例、表结构脚本

- 进行最终验证：部署项目到测试环境，执行完整流程验证，确保稳定运行

- 产出物：完整项目文档、可部署的项目代码包、最终验证报告

## 三、关键保障措施

- **进度管控**：每周日晚复盘本周任务完成情况，若出现延迟（如Go知识学习滞后），优先压缩“可选功能”（如SAGA事务）的时间，保障核心功能进度。

- **学习与开发平衡**：每个开发阶段前先花1-2小时补充所需Go知识，避免“边开发边卡壳”；优先使用成熟第三方库（如viper、robfig/cron），减少重复造轮子。

- **质量保障**：每个模块开发完成后必须编写测试用例，集成测试覆盖核心流程，避免后期大规模bug堆积。

- **风险应对**：若并发调度、DAG解析等核心难点卡壳，可先实现简化版本（如先支持线性依赖，再扩展复杂DAG），逐步迭代优化。

## 四、最终交付物清单

1. 完整项目代码（按模块组织：model/、repository/、builder/、controller/、engine/、executor/等）

2. 测试代码集（单元测试、集成测试、全链路测试、压力测试）

3. 配置文件示例（YAML格式，含数据库、并发、插件、定时等配置）

4. 数据库表结构脚本（SQLite/MySQL/PostgreSQL）

5. 项目文档（用户手册、开发手册、API文档）

6. 验证报告（功能验证、性能测试、兼容性测试）
> （注：文档部分内容可能由 AI 生成）